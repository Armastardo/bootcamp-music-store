CREATE DATABASE "music-store";

CREATE TABLE cat_client_type (
	cat_client_type_id integer,
	cat_client_type varchar (50),
	cat_client_description varchar (150),
	PRIMARY KEY (cat_client_type_id)
);

CREATE TABLE client (
	client_id integer,
	client_name varchar(50),
	client_surnam varchar(50),
	client_mal varchar(100),
	cat_client_type_id integer,
	stars integer,
	PRIMARY KEY(client_id),
	CONSTRAINT fk_client_type
		FOREIGN KEY (cat_client_type_id)
			REFERENCES cat_client_type(cat_client_type_id)
);

CREATE TABLE cat_repayment_type (
	cat_repayment_type_id integer,
	cat_repayment_type varchar(100),
	cat_repayment_description varchar(255),
	PRIMARY KEY (cat_repayment_type_id)
);

CREATE TABLE repayment (
	repayment_id integer,
	repayment_date date,
	reason varchar(255),
	purchase_id integer,
	cat_repayment_id integer,
	CONSTRAINT fk_repayment_type
		FOREIGN KEY (cat_repayment_id)
			REFERENCES cat_repayment_type(cat_repayment_type_id),
	album_id integer,
	quantity integer,
	PRIMARY KEY (repayment_id)
);

CREATE TABLE purchase (
	purchase_id integer,
	client_id integer,
	purchase_date date,
	quantity integer,
	amount decimal,
	album_id integer,
	repayment_id integer,
	CONSTRAINT fk_repaiment_id
		FOREIGN KEY (repayment_id)
			REFERENCES repayment (repayment_id),
	PRIMARY KEY (purchase_id)
);

CREATE TABLE album (
	album_id integer,
	album_name varchar(150),
	year_release date,
	description varchar(255),
	is_active boolean,
	quantity_available integer,
	artist_id integer,
	PRIMARY KEY (album_id)
);

CREATE TABLE cat_genre (
	cat_genre_id integer,
	cat_genre_name varchar(255),
	description varchar (255),
	PRIMARY KEY (cat_genre_id)
);

CREATE TABLE song (
	song_id integer,
	song_name varchar(255),
	album_id integer,
	CONSTRAINT fk_song_album_id
		FOREIGN KEY (album_id)
			REFERENCES album(album_id),
	duration integer,
	cat_genre_id integer,
	CONSTRAINT fk_song_cat_genre
		FOREIGN KEY (cat_genre_id)
			REFERENCES cat_genre (cat_genre_id),
	PRIMARY KEY (song_id)
);

CREATE TABLE artist (
	artist_id integer,
	artist_name varchar(255),
	year_form date,
	is_single boolean,
	house_record_id integer,
	description varchar(255),
	album_id integer,
	CONSTRAINT fk_artist_album_id
		FOREIGN KEY (album_id)
			REFERENCES album (album_id),
	PRIMARY KEY (artist_id)
);

CREATE TABLE house_record (
	house_record_id integer,
	house_record_name varchar(255),
	year_from date,
	description varchar(255),
	PRIMARY KEY (house_record_id)
);

ALTER TABLE repayment
	ADD CONSTRAINT fk_repayment_purchase_id
		FOREIGN KEY (purchase_id)
			REFERENCES purchase (purchase_id);

ALTER TABLE repayment
	ADD CONSTRAINT fk_repayment_album_id
		FOREIGN KEY (album_id)
			REFERENCES album (album_id);

ALTER TABLE purchase
	ADD CONSTRAINT fk_purchase_album_id
		FOREIGN KEY (album_id)
			REFERENCES album (album_id);

ALTER TABLE album
	ADD CONSTRAINT fk_album_artist_id
		FOREIGN KEY (artist_id)
			REFERENCES artist (artist_id);

ALTER TABLE artist
	ADD CONSTRAINT fk_artist_house_record
		FOREIGN KEY (house_record_id)
			REFERENCES house_record (house_record_id);